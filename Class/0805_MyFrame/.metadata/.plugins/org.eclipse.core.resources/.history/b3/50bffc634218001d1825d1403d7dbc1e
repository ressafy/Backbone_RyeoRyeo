package dto;


public class BookManager {

	public final static int MAX_SIZE=100;
	private Book[] books;
	private int size;

	public BookManager(){
		this.books = new Book[MAX_SIZE];
		this.size = 0;
	}

	public void add(Book book) {
		this.books[this.size] = book;
		this.size++;
	}

	public void remove(String isbn) {
		if (size > 0) {
			int idx = -1;
			for (int i = 0; i < size; i++) {
				if (books[i].getIsbn().equals(isbn)) {
					idx = i;
					break;
				}
			}

			if (idx != -1) {
				for (int i = idx; i<size-1; i++) {
					books[i] = books[i+1];
				}
				books[size-1] = null;
				size--;
			}
		}
	}

	public Book[] getList() {
		Book[] bArr = new Book[size];
		for (int i = 0; i < size; i++) {
			bArr[i] = books[i];
		}
		return bArr;
	}

	public Book searchByIsbn(String isbn) {
		for(Book book : books) {
			if(book.getIsbn().equals(isbn)) {
				return book;
			}
		}
		return null;
	}

	public Book[] searchByTitle(String title) {
		int matchCnt = 0;

		for(Book book : books) {
			try {
				if (book.getTitle().contains(title)) {
					matchCnt++;
				}
			} catch (NullPointerException e) {
				break;
			}
		}

		int curIdx = 0;
		Book[] resBooks = new Book[matchCnt];
		for(Book book : books) {
			try {
				if (book.getTitle().contains(title)) {
					resBooks[curIdx] = book;
					curIdx++;
				}
			} catch (NullPointerException e) {
				break;
			}
		}


		return resBooks;
	}

	public Magazine[] getMagazines() {
		int magaNum = 0;
		for (int i = 0; i < size; i++) {
			if (books[i].getClass().getName().equals("com.ssafy.ws.step3.Magazine")) {
				magaNum++;
			}
		}

		Magazine[] resMaga = new Magazine[magaNum];
		int idx = 0;
		for (int i = 0; i < size; i++) {
			if (books[i].getClass().getName().equals("com.ssafy.ws.step3.Magazine")) {
				resMaga[idx] = (Magazine)books[i];
				idx++;
			}
		}

		return resMaga;
	}

	public Book[] getBooks() {
		int bookNum = 0;
		for (int i = 0; i < size; i++) {
			if (books[i].getClass().getName().equals("com.ssafy.ws.step3.Book")) {
				bookNum++;
			}
		}

		Book[] resBooks = new Book[bookNum];
		int idx = 0;
		for (int i = 0; i < size; i++) {
			if (books[i].getClass().getName().equals("com.ssafy.ws.step3.Book")) {
				resBooks[idx] = books[i];
				idx++;
			}
		}

		return resBooks;
	}

	public int getTotalPrice() {
		int totalPrice = 0;
		for (int i = 0; i < size; i++) {
			totalPrice += books[i].getPrice();
		}

		return totalPrice;
	}

	public double getPriceAvg() {
		int tP = getTotalPrice();
		double avg = (tP*1.0)/size;

		return avg;
	}

}
